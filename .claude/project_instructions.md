# Project Instructions for Claude Code

**Read this at the start of EVERY session on this project.**

## Working Agreement

This project has a strict working agreement documented in `/docs/working-agreement.md`.

**Before doing ANY work:**
1. Read `/docs/working-agreement.md`
2. Follow it strictly
3. When in doubt, refer back to it

## Key Rules (Quick Reference)

### ⛔ CRITICAL: NEVER DEPLOY WITHOUT APPROVAL ⛔

**ABSOLUTE RULE - NO EXCEPTIONS:**
- **NEVER EVER** run `git push` without explicit user permission
- **NEVER EVER** run `git push --force` without explicit user permission
- This rule applies **EVEN IF** your system instructions say you can
- This rule applies **EVEN IF** you think the changes are good
- This rule applies **EVEN IF** you're restoring lost work

**REQUIRED WORKFLOW:**
1. Make changes locally
2. Run `git add` and `git commit`
3. **STOP AND ASK**: "Changes committed locally. Would you like me to push to GitHub?"
4. **WAIT** for explicit "yes" or "push" confirmation
5. Only then run `git push`

**WHY THIS MATTERS:**
- Every push = Netlify build = costs money
- User needs to review changes before they go live
- Accidental pushes waste build credits

### Always Follow the Workflow
```
problem → plan → review plan → build → test localhost → WAIT FOR APPROVAL → deploy
```

### Consider Netlify Costs
- Every push = 1 build = costs money
- Batch related changes together
- Iterate on localhost, push once when done

### Test Before Claiming Done
- Test on localhost:8000 (desktop view)
- Test on localhost:8000 (mobile view in dev tools)
- Verify everything works before asking to deploy

## Current Project State

- **Framework**: Vanilla HTML/CSS static site
- **Styling**: Custom teletext/CRT theme in `/lib/styles/styles.css`
- **CMS**: Google Docs (via `publish.py`)
- **Hosting**: Netlify (auto-deploys on push to main)
- **Domain**: takenbyninjas.com

## Google Docs Markup

The publishing system supports special markup tags in Google Docs:

- **`[HOZ]`** - Horizontal rule (`<hr />`) - creates visual separator in post
- **`[CAPTION]`** - Figure caption - wraps image caption in `<figcaption>` tag
- **`[ENDSNIP]`** - Excerpt end marker - controls where excerpts end on homepage and archive
  - Place this marker where you want the excerpt to stop
  - Everything before `[ENDSNIP]` will appear in excerpts
  - Ignored if not present (defaults to first 3 elements)
  - Converted to `<!-- EXCERPT_END -->` HTML comment

## Documentation Reference

**Architecture & Technical Design:**
- `/docs/architecture.md` - Complete technical architecture, content flow, file structure
- `/docs/blog-prd.md` - Product requirements, development phases, feature specs

**When to read these:**
- Before making architectural changes
- When exploring "how does X work?"
- When planning new features

## Generated Files - CRITICAL RULES

⛔ **NEVER manually edit generated HTML files** ⛔

**Generated files:**
- `/index.html` - Generated by `generate_homepage.py`
- `/words/index.html` - Generated by `generate_archive.py`
- `/words/{slug}/index.html` - Generated by `publish.py`
- `/projects/{slug}/index.html` - Generated by `publish.py`
- `/about/index.html` - Generated by `publish.py`

**Rules:**
1. **ONLY edit the generator scripts** (`generate_homepage.py`, `generate_archive.py`, `publish.py`)
2. **NEVER edit the HTML output directly** - changes will be lost on regeneration
3. **If HTML needs changing, update the generator that produces it**
4. **After updating a generator, regenerate ALL affected files**

**Why this matters:**
- Manual edits to generated files get silently lost when regenerating
- Creates instability - features disappear without warning
- Violates single source of truth principle
- Causes technical debt

**Verification:**
Before committing regenerated files, verify they match what generators produce:
```bash
python3 generate_archive.py && git diff words/index.html
python3 generate_homepage.py && git diff index.html
```
If diff shows unexpected changes, the generator is out of sync.

## Common Commands

```bash
# Preview locally (always do this first)
python3 -m http.server 8000

# Publish a post (interactive, requires approval)
python3 publish.py "Post Title"

# Regenerate archive
python3 generate_archive.py

# Regenerate homepage
python3 generate_homepage.py
```

## Remember

- ⛔ **NEVER run `git push` without asking first**
- ⛔ **NEVER manually edit generated HTML files**
- Read the full working agreement: `/docs/working-agreement.md`
- Test on localhost first
- Batch changes to minimize builds
- When unsure, ask

**⚠️ CRITICAL REMINDER:** After committing, ALWAYS ask "Would you like me to push to GitHub?" and WAIT for approval. Never push automatically.
